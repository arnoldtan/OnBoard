<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Lesson</title>
	<link rel="stylesheet" href="/styles/normalize.css">
	<link rel="stylesheet" href="/styles/skeleton.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
	<style>
	
		* {
			box-sizing: border-box;
		}

		html, body {
			height: 100%;
			width: 100%;
		}

		#main {
			width: 100%;
			max-width: 100%;
			background-size: cover;
			background-color: #fcfcfc;
			box-shadow: 0px 0px 10px 0px #969594;
			color: #333;
		}

		header {
			padding: 32px;
			height: 96px;
			background: linear-gradient(rgba(7, 148, 57, 1), rgba(7, 148, 57, 1));
			width: 100%;
			color: white;
			position: fixed;
			top: 0;
			z-index: 10;
		}

		header ul {
			list-style-type: none;
			width: 50%;
			float: left;
		}

		header ul li {
			float: left;
		}

		#main .row {
			width: 100%;
			max-width: 100%;
			padding-top: 2.5%;
		}

		#logo {
			height: 32px;
		}
		
		a.button {
			color: white;
		}
		
		.right li {
			float: right;
			margin-right: 1em;
		}

		#navbar {
			background-color: #00FF99;
			padding: 1em 1em 0 2em !important;
			position: fixed;
			top: 96px;
			z-index: 10;
			height: 80px;
		}

		#class-code-heading {
			display: inline-block;
		}

		#resource-button {
			background-color: #FFAE19;
		}

		#resource-button:hover {
			background-color: #FFA500;
		}

		#forum {
			margin-top: 176px;
			padding-top: 2em;
			z-index: 0;
		}

		#post-form-content, #post-form-submit-button {
			display: block;
			margin: 0 auto;
		}

		.post {
			background-color: #FAE1DD;
			text-align: left;
			width: 50%;
			border-radius: 10px;
			padding: 1.5em;
			margin-left: auto;
			margin-right: auto;
			margin-top: 1em;
			opacity: 0.7;
			overflow: scroll;
		}

	</style>
	<script src="/scripts/jquery-2.1.4.min.js"></script>
</head>
<body>
	<div class="container" id="main">
		<header>
			<ul>
				<li><img src="/images/logo.png" id="logo"></li>
			</ul>
			<ul class="right">
				<li><a class="button" href="/logout">Log Out</a></li>
				<li><a class="button" href="/dashboard">Dashboard</a></li>
			</ul>
		</header>
		<div class="row" id="navbar">
			<div class="three columns">
				<h3 style="overflow:hidden"><%= Class.className %></h3>
			</div>
			<% if (user.type === 'teacher') { %>
				<div class="five columns">
					<h6 id="class-code-heading">Class Code:</h6>
					<input type="text" id="class-code" value="<%= Class.classCode %>" disabled>
					<input type="button" id="copy-to-clipboard" value="COPY TO CLIPBOARD">
				</div>
				<div class="two columns">
					<input type="button" id="manage-whiteboard-button" class="button button-primary" value="WHITEBOARD MANAGEMENT">
				</div>
			<% } else if (user.type === 'student') { %>
				<div class="seven columns">
					<h5>There are no live lessons right now.</h5>
				</div>
			<% } %>
			<div class="two columns">
				<input type="button" id="resource-button" class="button button-primary" value="RESOURCES">
			</div>
		</div>
		<div id="forum">
			<form action="/post/add" method="post">
				<input type="text" style="display:none" name="classCode" value="<%= Class.classCode %>">
				<textarea id="post-form-content" rows="20" cols="80" name="content" placeholder="Type your post here"></textarea>
				<input id="post-form-submit-button" type="submit" value="POST">
			</form>
			<% for (var i=posts.length-1; i>-1; --i) { %>
				<div class="post">
					<h3><%= posts[i].dataValues.User.username %></h3>
					<p style="font-size:24px"><%= posts[i].dataValues.content %></p>
					<p style="font-size:12px; text-align:right; margin-bottom:0"><%= posts[i].dataValues.updatedAt %></p>
				</div>
			<% } %>
	</div>
	<script src="/scripts/jquery-2.1.4.min.js"></script>
	<script>
		if ('<%= user.type %>' === 'teacher') {
			var copy_to_clipboard = document.getElementById('copy-to-clipboard');
			copy_to_clipboard.addEventListener('click', function(e) {
				window.getSelection().removeAllRanges();
				var classCode = document.getElementById('class-code');
				var range = document.createRange();
				range.selectNode(classCode);
				window.getSelection().addRange(range);

				try {
					var successful = document.execCommand('copy');  
	    		var msg = successful ? 'successful' : 'unsuccessful';  
	    		console.log('Copy class code command was ' + msg);  
	  		} catch(err) {  
	    		console.log('Oops, unable to copy');  
	  		}
	  		window.getSelection().removeAllRanges();
			});

			var manage_whiteboard_button = document.getElementById('manage-whiteboard-button');
			manage_whiteboard_button.addEventListener('click', function(e) {
				location.href += '/lesson/manage';
			});
		}

		var resource_button = document.getElementById('resource-button');
		resource_button.addEventListener('click', function(e) {
			location.href += '/resource';
		});

		$(document).ready(function() {
			$('.post').hover(function(e) {
				$(this).fadeTo(100, 1);
			}, function(e) {
				$(this).fadeTo(100, 0.7);
			});
		});
	</script>
</body>
</html>